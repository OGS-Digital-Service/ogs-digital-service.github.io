function changeRating(changeLink,hiddenLinkWidth){$.cookies.del(generatePageName());var cl=$(changeLink),activeVote=cl.siblings(".vote"),hiddenVote=cl.siblings("a").not(".vote"),written=$("#written-feedback");cl.fadeOut("slow").delay(250).remove(),activeVote.removeClass("vote"),postRating("0","change"),hiddenVote.on("click",ratingClick).animate({opacity:1,width:hiddenLinkWidth},{duration:650,queue:!1}),written.is(":visible")&&written.slideUp("slow")}function addChangeRating(rating,hiddenLinkWidth,moreInfo){var changeLink=$('<a id="change-link" href="#">Change</a>').on("click",function(e){e.preventDefault(),changeRating(this,hiddenLinkWidth)});changeLink.delay(500).insertAfter(rating).fadeIn("fast",function(){moreInfo&&$("#written-feedback").slideDown()})}function markRating(rating){var negVote=rating.hasClass("downvote"),moreInfo=!1,updown="1";actionType=$("#ratings").attr("data-type"),negVote&&(moreInfo=!0,updown="-1"),rating.addClass("vote"),otherRatingWidth=rating.siblings("a").width(),rating.siblings("a").off("click").animate({opacity:0,width:0},{duration:650,queue:!1,complete:addChangeRating(rating,otherRatingWidth,moreInfo)}),postRating(updown,actionType),negVote||showThanks()}function showThanks(){$("#pr-thank-you span").fadeIn("slow").delay(2500).fadeOut("slow")}function ratingClick(e){e.preventDefault(),ratingLink=$(this),ratingLink.hasClass("vote")||markRating(ratingLink)}function hideCommentShowThanks(e){$("#written-feedback").slideUp("slow",showThanks)}function writtenSubmit(e){e.preventDefault(),""!=$("#written-feedback textarea").val()&&(postComment($("#written-feedback textarea").val()),hideCommentShowThanks())}function postRating(updown,actionType){var postedData="",optionalData="",pageVersion="0",pageLastUpdate="",processingPage="/app/page-feedback/page-feedback.php";if($('meta[name="revisionNumber"]').length&&(pageVersion=$('meta[name="revisionNumber"]').attr("content"),optionalData+="&pageVersion="+pageVersion),$('meta[name="lastUpdated"]').length&&(pageLastUpdate=$('meta[name="lastUpdated"]').attr("content"),optionalData+="&pageLastUpdate="+pageLastUpdate),postedData="type="+actionType+"&rating="+updown+"&pageURL="+window.location+optionalData,"insert"==actionType)$.ajax({type:"POST",url:processingPage,data:postedData}).done(function(data){$("#ratings").attr("data-key",data.substring(0,10)),createRatingCookie(updown,data.substring(0,10),pageVersion,pageLastUpdate)}).fail(function(jqXHR,textStatus){}),$("#ratings").attr("data-type","change");else{var userKey=$("#ratings").attr("data-key");$.ajax({type:"POST",url:processingPage,data:"type="+actionType+"&rating="+updown+"&pageURL="+window.location+"&userKey="+userKey}).done(function(){"0"!=updown&&createRatingCookie(updown,userKey,pageVersion,pageLastUpdate)}).fail(function(jqXHR,textStatus){})}}function postComment(comment){var userKey=$("#ratings").attr("data-key"),processingPage="/app/page-feedback/page-feedback.php";$.ajax({type:"POST",url:processingPage,data:"type=comment&pageComment="+comment+"&userKey="+userKey})}function generatePageName(){var sPath=window.location.pathname,sPage=sPath.substring(sPath.lastIndexOf("/")+1);return""==sPage&&(sPage=sPath.split("/"),sPage=sPage[sPage.length-2]+"-index"),sPage}function createRatingCookie(updown,userKey,pageVersion,pageLastUpdate){var d=new Date,time=d.getTime()+18e5.toString(),pageCookie={rating:updown,userKey:userKey,pageVersion:pageVersion,pageLastUpdate:pageLastUpdate,expireTime:time},cookieSettings={expiresAt:d.setDate(d.getDate()+30)};$.cookies.set(generatePageName(),pageCookie,cookieSettings)}function existingRating(vote,cookieVal){var d=new Date;time=d.getTime(),vote?ratingLink=$(".upvote"):ratingLink=$(".downvote"),$('meta[name="revisionNumber"]').attr("content")==cookieVal.pageVersion||!$('meta[name="revisionNumber"]').length&&"0"==cookieVal.pageVersion?time<parseInt(cookieVal.expireTime)?(ratingLink.addClass("vote"),initializePageRating(!1),$("#ratings").attr("data-type","change").attr("data-key",cookieVal.userKey),otherRatingWidth=ratingLink.siblings("a").width(),ratingLink.siblings("a").off("click").animate({opacity:0,width:0},{duration:0,queue:!1,complete:addChangeRating(ratingLink,otherRatingWidth,!1)}),showPageRating()):(ratingLink.addClass("vote locked").on("click",function(e){e.preventDefault()}).siblings("a").hide(),showPageRating()):($.cookies.del(generatePageName()),initializePageRating(!0))}function initializePageRating(show){var upvote=$("#ux-page-rating .upvote"),downvote=$("#ux-page-rating .downvote"),feedback=$("#feedBackSubmit"),noComment=$(".no-comment");upvote.on("click",ratingClick),downvote.on("click",ratingClick),feedback.on("click",writtenSubmit),noComment.on("click",hideCommentShowThanks),show&&showPageRating()}function showPageRating(){$("#ux-page-rating").animate({opacity:1},{duration:2e3,queue:!1})}$(document).ready(function(){if("https:"==location.protocol)$("#ux-page-rating").hide();else if($("#ux-page-rating")){var cookieVal=$.cookies.get(generatePageName()),rating=!0;cookieVal&&cookieVal.rating?("-1"==cookieVal.rating&&(rating=!1),existingRating(rating,cookieVal)):initializePageRating(!0)}});
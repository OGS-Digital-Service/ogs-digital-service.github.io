!function($){$.fn.popover=function(options){var defaults={bEnsurePlacement:!0,iSidePadding:5,iTopPadding:10,placementFunction:function(link,submenu,defaults){function findLeft(){return left=linkPosLeft-subMenuHalf+linkHalf,left+subMenuWidth>containWidth||left<0?left<0?(link.hasClass("pop-right")&&link.removeClass("pop-right"),0):(link.addClass("pop-right"),containWidth-subMenuWidth-defaults.iSidePadding):void 0}function findTop(){if(defaults.bEnsurePlacement){var pageElmTop=link.offset().top,bottomPopover=pageElmTop+link.outerHeight()+subMenuHeight,containBottom=windowHeight+$(window).scrollTop();return bottomPopover>containBottom?(link.addClass("pop-up"),linkPosTop-subMenuHeight-defaults.iTopPadding):(link.hasClass("pop-up")&&link.removeClass("pop-up"),linkPosTop+link.outerHeight())}return linkPosTop+link.outerHeight()}var containWidth=0,containHeight=0,windowWidth=$(window).width(),windowHeight=$(window).height(),relParent=link.offsetParent(),relParentWidth=relParent.outerWidth(),relParentHeight=relParent.outerHeight(),subMenuWidth=submenu.outerWidth(),subMenuHeight=submenu.outerHeight(),subMenuHalf=subMenuWidth/2,linkPos=link.position(),linkPosLeft=linkPos.left,linkPosTop=linkPos.top;linkHalf=link.outerWidth()/2,linkPosCenter=0,defaults.bEnsurePlacement&&relParentWidth>windowWidth?(containWidth=windowWidth,containHeight=windowHeight):(containWidth=relParentWidth,containHeight=relParentHeight),submenu.css({top:findTop(),left:findLeft()})}};return defaults=$.extend(defaults,options),this.each(function(i){var link=$(this),submenu=link.next("div:first");link.parents("ux.content");submenu.addClass("ux-submenu"),link.on("click",function(e){e.preventDefault(),e.stopPropagation(),submenu.is(":visible")?link.removeClass("selected"):($(".ux-popover.selected").removeClass("selected"),link.addClass("selected"),"auto"==link.css("top")&&defaults.placementFunction(link,submenu,defaults),$("body").on("click",function(){link.removeClass("selected")}))})})}}(jQuery);